<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Choix du Genre</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: url('fond.png') no-repeat center center fixed;
            background-size: cover;
            font-family: 'Georgia', serif;
            color: #f3e9e2;
            overflow: hidden;
        }

        .genre-choice {
            text-align: center;
        }

        .genre-choice h1 {
            font-size: 4em;
            margin: 0.1em 0;
            color: #f3e9e2;
            letter-spacing: 0.1em;
            cursor: pointer;
            font-weight: bold;
        }
        .genre-choice h1:hover {
            color: #f7a7b5;
        }

        .click-area {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Contenu central pour le choix du genre -->
    <div class="genre-choice">
        <h1 class="click-area" onclick="choisirGenre('femme')">FEMME</h1>
        <h1 class="click-area" onclick="choisirGenre('homme')">HOMME</h1>
    </div>

    <script>
        const SHEET_ID = "1wV1J-YQw8WPiMNCFIPVfHWSmasiQVy7fUUe_KaqwYOI"; // ID de votre Google Sheet
        const API_KEY = "AIzaSyA9xvkIzsZtb-RlsQWGPosdf6rtbAF8WRY";       // Clé API Google Cloud
        const SHEET_URL = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Tirages?key=${API_KEY}`;
       // const APPEND_URL = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/Tirages:append?valueInputOption=RAW&key=${API_KEY}`;

        async function choisirGenre(genre) {
            await lancerTirage(genre);
        }

        async function lancerTirage(genre) {
            const today = new Date().toISOString().slice(0, 10);

            try {
                // Récupérer les données actuelles de la feuille
                const response = await fetch(SHEET_URL);
                const data = await response.json();

                // Vérification des lignes existantes
                const rows = data.values || [];
                const tirageDuJour = rows.find(row => row[0] === today);

                if (tirageDuJour) {
                    // Un gagnant a déjà été attribué aujourd'hui
                    const gagnantGenre = tirageDuJour[1];
                    const isGagnant = gagnantGenre === genre;
                    lancerVideo(isGagnant ? "gagner_1.mov" : "perdu.mp4");
                } else {
                    // Pas encore de gagnant : enregistrer un nouveau tirage
                    const ajoutResponse = await fetch(APPEND_URL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            values: [[today, genre]]
                        })
                    });

                    if (ajoutResponse.ok) {
                        lancerVideo("gagner_1.mov");
                    } else {
                        throw new Error("Erreur lors de l'ajout du tirage.");
                    }
                }
            } catch (error) {
                console.error("Erreur lors de la communication avec Google Sheets :", error);
                alert("Une erreur est survenue. Veuillez réessayer plus tard.");
            }
        }

        function lancerVideo(videoFile) {
            const video = document.createElement("video");
            video.src = videoFile;
            video.autoplay = true;
            video.muted = true;
            video.loop = false;
            video.playsInline = true;
            video.style.width = "100%";
            video.style.height = "100vh";
            video.style.objectFit = "cover";
            video.style.pointerEvents = "none";
            video.setAttribute("playsinline", "");
            video.setAttribute("autoplay", "true");
            video.setAttribute("muted", "true");

            document.body.innerHTML = "";
            document.body.appendChild(video);
        }
    </script>
</body>
</html>
